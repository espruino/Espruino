ªr(c,h){ªd(e){Ñram;e.idž(n[e.id]=e);e.type (e.type="");e.cže.c.forEach(d)}¯._l=¯.l=c;¯.options=h {};¯.lazy=¯.options.lazy !Ô;¯.physBtns=Ô;­k;£(ÔŒprocess.env.HWVERSION){¯.physBtns=Ô;k=[];ªe(p){Ñram;ÑbtnŠp.typežk.push(p);p.cžp.c.forEach(e)}e(c);k.lengthž(¯.physBtns=Ó,¯.buttons=k,¯.selectedButton=Ôÿ)}£(¯.options.btns)£(c=¯.options.btns,¯.physBtns‘c.length){¯.b=c;­e=Math.floor(Bangle.appRect.h/¯.physBtns);§(Ô<¯.physBtnsžÔŠc.lengthžc.unshift({label:""});¯.physBtns>c.length;)c.push({label:""});¯._l.width=g.getWidth()-Ô;¯._l={type:Ñh,filly:Ô,c:[¯._l,{type:Ñv,pad:Ô,filly:Ô,c:c.map(p¢(p.type=Ñtxt,p.font=Ñ6x8,p.height=e,p.r=Ô,p))}]}}¤¯._l.width=g.getWidth()-Ô ,¯._l={type:Ñh,c:[¯._l,{type:Ñv,c:c.map(e¢(e.type=Ñbtn,e.filly=Ô,e.width=Ô ,e.r=Ô,e))}]},kžk.push.apply(k,¯._l.c[Ô].c);¯.setUI();¬n=¯;d(¯._l);¯.updateNeeded=!Ó}ªu(c,h,d,k,n){¬e=¶Šc.bgCol?n:g.toColor(c.bgCol);£(eŒn ÑtxtŠc.type ÑbtnŠc.type ÑimgŠc.type ÑcustomŠc.type){¬p=c.c;¾c.c;¬a=ÑH+E.CRC32(E.toJS(c));pž(c.c=p);¾h[a] ((k[a]=[c.x,c.y,c.x+c.w-Ô,c.y+c.h-Ô]).bg=¶Šn?g.theme.bg:n,dž(d.push(c),d=¶))}£(c.c)§(¬bÆc.c)u(b,h,d,k,e)}r.prototype.setUI=ª(){Bangle.setUI();­c;¯.buttonsž(Bangle.setUI({mode:Ñupdown,back:¯.options.back,remove:¯.options.remove},h¢{¬d=¯.selectedButton,k=¯.buttons.length;£(ÀÓ‹hž¯.buttons[d])«¯.buttons[d].cb();¯.buttons[d]ž(¾¯.buttons[d].selected,¯.render(¯.buttons[d]));d=(d+k+h)%k;¯.buttons[d]ž(¯.buttons[d].selected=Ô,¯.render(¯.buttons[d]));¯.selectedButton=d}),c=!Ó);!¯.options.backž!¯.options.remove c Bangle.setUI({mode:Ñcustom,back:¯.options.back,remove:¯.options.remove});£(¯.b){ªh(d,k){.75<k.time-k.lastTimež¯.b[d].cbl?¯.b[d].cbl(k):¯.b[d].cbž¯.b[d].cb(k)}Bangle.btnWatchesžBangle.btnWatches.forEach(clearWatch);Bangle.btnWatches=[];¯.b[Ó]žBangle.btnWatches.push(setWatch(h.bind(¯,Ó),BTN1,{repeat:!Ó,edge:Ôÿ}));¯.b[Ô]žBangle.btnWatches.push(setWatch(h.bind(¯,Ô),BTN2,{repeat:!Ó,edge:Ôÿ}));¯.b[Ô]žBangle.btnWatches.push(setWatch(h.bind(¯,Ô),BTN3,{repeat:!Ó,edge:Ôÿ}))}£(ÔŠprocess.env.HWVERSION){ªh(d,k){d.cbžk.x‘d.xžk.y‘d.yžk.xŽd.x+d.wžk.yŽd.y+d.hž(ÔŠk.typežd.cbl?d.cbl(k):d.cbžd.cb(k));d.cžd.c.forEach(n¢h(n,k))}Bangle.touchHandler=(d,k)¢h(¯._l,k);Bangle.on(Ñtouch,Bangle.touchHandler)}};r.prototype.render=ª(c){ªh(b){Ñram;d.reset();ÀÓb.colžd.setColor(b.col);ÀÓb.bgColžd.setBgColor(b.bgCol).clearRect(b.x,b.y,b.x+b.w-Ô,b.y+b.h-Ô);k[b.type](b)}c (c=¯._l);¯.updateNeededž¯.update();¬d=g,k={"":ª(){},txt:ª(b){Ñram;£(b.wrap){¬l=d.setFont(b.font).setFontAlign(Ó,Ôÿ).wrapString(b.label,b.w),m=b.y+(b.h-d.getFontHeight()*l.length’Ô);d.drawString(l.join(Ñ
),b.x+(b.w’Ô),m)}¤d.setFont(b.font).setFontAlign(Ó,Ó,b.r).drawString(b.label,b.x+(b.w’Ô),b.y+(b.h’Ô))},btn:ª(b){Ñram;¬l=b.x+(Ó|b.pad),m=b.y+(Ó|b.pad),q=b.w-(b.padÔ),f=b.h-(b.padÔ);l=[l,m+Ô,l+Ô,m,l+q-Ô,m,l+q-Ô,m+Ô,l+q-Ô,m+f-Ô,l+q-Ô,m+f-Ô,l+Ô,m+f-Ô,l,m+f-Ô,l,m+Ô];m=ÀÓb.btnBorderCol?b.btnBorderCol:d.theme.fg2;q=ÀÓb.btnFaceCol?b.btnFaceCol:d.theme.bg2;b.selectedž(q=d.theme.bgH,m=d.theme.fgH);d.setColor(q).fillPoly(l).setColor(m).drawPoly(l);ÀÓb.colžd.setColor(b.col);b.src?d.setBgColor(q).drawImage(ÑfunctionŠ¿b.src?b.src():b.src,b.x+b.w/Ô,b.y+b.h/Ô,{scale:b.scale ÀÓ,rotate:.5*Math.PI*(b.r Ó)}):d.setFont(b.font Ñ6x8:2).setFontAlign(Ó,Ó,b.r).drawString(b.label,b.x+b.w/Ô,b.y+b.h/Ô)},img:ª(b){Ñram;d.drawImage(ÑfunctionŠ¿b.src?b.src():b.src,b.x+b.w/Ô,b.y+b.h/Ô,{scale:b.scale ÀÓ,rotate:.5*Math.PI*(b.r Ó)})},custom:ª(b){Ñram;b.render(b)},h:ª(b){Ñram;b.c.forEach(h)},v:ª(b){Ñram;b.c.forEach(h)}};£(¯.lazy){¯.rects (¯.rects={});¬n=¯.rects.clone(),e=[];u(c,n,e,¯.rects,¶);§(¬p¹n)¾¯.rects[p];c=Object.keys(n).map(b¢n[b]).reverse();§(¬aÆc)d.setBgColor(a.bg).clearRect.apply(g,a);e.forEach(h)}¤h(c)};r.prototype.forgetLazyState=ª(){¯.rects={}};r.prototype.debug=ª(c,h){c (c=¯._l);h=h Ô;g.setColor(h&Ô,h&Ô,h&Ô).drawRect(c.x+h-Ô,c.y+h-Ô,c.x+c.w-h,c.y+c.h-h);c.padžg.drawRect(c.x+c.pad-Ô,c.y+c.pad-Ô,c.x+c.w-c.pad,c.y+c.h-c.pad);h˜;c.cžc.c.forEach(d¢¯.debug(d,h))};r.prototype.update=ª(){ªc(a){Ñram;n[a.type](a);£(a.r&Ô){¬b=a._w;a._w=a._h;a._h=b}a._w=d(a._w+(a.padÔ),Ó|a.width);a._h=d(a._h+(a.padÔ),Ó|a.height)}¾¯.updateNeeded;¬h=g,d=Math.max,k=Math.round,n={txt:ª(a){Ñram;a.font.endsWith(Ñ%)ž(a.font=ÑVector+k(h.getHeight()*a.font.slice(Ó,Ôÿ)/Ôd));£(a.wrap)a._h=a._w=Ó;¤{¬b=h.setFont(a.font).stringMetrics(a.label);a._w=b.width;a._h=b.height}},btn:ª(a){Ñram;a.fontža.font.endsWith(Ñ%)ž(a.font=ÑVector+k(h.getHeight()*a.font.slice(Ó,Ôÿ)/Ôd));¬b=a.src?h.imageMetrics(ÑfunctionŠ¿a.src?a.src():a.src):h.setFont(a.font Ñ6x8:2).stringMetrics(a.label);a._h=Ô+b.height;a._w=Ô+b.width},img:ª(a){Ñram;¬b=h.imageMetrics(ÑfunctionŠ¿a.src?a.src():a.src),l=a.scale Ô;a._w=b.width*l;a._h=b.height*l},"":ª(a){Ñram;a._w=Ó;a._h=Ó},custom:ª(a){Ñram;a._w=Ó;a._h=Ó},h:ª(a){Ñram;a.c.forEach(c);a._h=a.c.reduce((b,l)¢d(b,l._h),Ó);a.__w=a._w=a.c.reduce((b,l)¢b+l._w,Ó);¶Ša.fillxža.c.some(b¢b.fillx)ž(a.fillx=Ô);¶Ša.fillyža.c.some(b¢b.filly)ž(a.filly=Ô)},v:ª(a){Ñram;a.c.forEach(c);a.__h=a._h=a.c.reduce((b,l)¢b+l._h,Ó);a._w=a.c.reduce((b,l)¢d(b,l._w),Ó);¶Ša.fillxža.c.some(b¢b.fillx)ž(a.fillx=Ô);¶Ša.fillyža.c.some(b¢b.filly)ž(a.filly=Ô)}},e=¯._l;c(e);e.fillx e.filly?(e.w=Bangle.appRect.w,e.h=Bangle.appRect.h,e.x=Bangle.appRect.x,e.y=Bangle.appRect.y):(e.w=e._w,e.h=e._h,e.x=Bangle.appRect.w-e.w’Ô,e.y=Bangle.appRect.y+(Bangle.appRect.h-e.h’Ô));¬p=Math.floor;n={h:ª(a){Ñram;¬b=a.x+(Ó|a.pad),l=Ó,m=a.cža.c.reduce((f,t)¢f+(Ó|t.fillx),Ó);m (b–a.w-(a.padÔ)-a.__w’Ô,m=Ô);¬q=b;a.c.forEach(f¢{f.x=Ó|q;b–f._w;l–Ó|f.fillx;q=b+p(l*(a.w-a._w)/m);f.w=Ó|q-f.x;f.h=Ó|(f.filly?a.h-(a.padÔ):f._h);f.y=Ó|a.y+(Ó|a.pad)+((Ô+(Ó|f.valign))*(a.h-(a.padÔ)-f.h)’Ô);£(f.c)n[f.type](f);¾f._w;¾f._h});¾a.__w},v:ª(a){Ñram;¬b=a.y+(Ó|a.pad),l=Ó,m=a.cža.c.reduce((f,t)¢f+(Ó|t.filly),Ó);m (b–a.h-(a.padÔ)-a.__h’Ô,m=Ô);¬q=b;a.c.forEach(f¢{f.y=Ó|q;b–f._h;l–Ó|f.filly;q=b+p(l*(a.h-a._h)/m);f.h=Ó|q-f.y;f.w=Ó|(f.fillx?a.w-(a.padÔ):f._w);f.x=Ó|a.x+(Ó|a.pad)+((Ô+(Ó|f.halign))*(a.w-(a.padÔ)-f.w)’Ô);£(f.c)n[f.type](f);¾f._w;¾f._h});¾a.__h}};£(n[e.type])n[e.type](e);¾e._w;¾e._h};r.prototype.clear=ª(c){c (c=¯._l);g.reset();ÀÓc.bgColžg.setBgColor(c.bgCol);g.clearRect(c.x,c.y,c.x+c.w-Ô,c.y+c.h-Ô)};exports=r