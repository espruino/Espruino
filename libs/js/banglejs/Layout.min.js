ªp(d,h){ªb(e){Ñram;e.idž(a[e.id]=e);e.type (e.type="");e.cže.c.forEach(b)}¯._l=¯.l=d;¯.options=h {};¯.lazy=¯.options.lazy !1;¯.physBtns=1;­f;£(2Œprocess.env.HWVERSION){¯.physBtns=3;f=[];ªe(l){Ñram;ÑbtnŠl.typežf.push(l);l.cžl.c.forEach(e)}e(d);f.lengthž(¯.physBtns=0,¯.buttons=f,¯.selectedButton=-1)}£(¯.options.btns)£(d=¯.options.btns,¯.physBtns‘d.length){¯.b=d;­e=Math.floor(Bangle.appRect.h/¯.physBtns);§(2<¯.physBtnsž1Šd.lengthžd.unshift({label:""});¯.physBtns>d.length;)d.push({label:""});¯._l.width=g.getWidth()-8;¯._l={type:Ñh,filly:1,c:[¯._l,{type:Ñv,pad:1,filly:1,c:d.map(l¢(l.type=Ñtxt,l.font=Ñ6x8,l.height=e,l.r=1,l))}]}}¤¯._l.width=g.getWidth()-32,¯._l={type:Ñh,c:[¯._l,{type:Ñv,c:d.map(e¢(e.type=Ñbtn,e.filly=1,e.width=32,e.r=1,e))}]},fžf.push.apply(f,¯._l.c[1].c);¯.setUI();¬a=¯;b(¯._l);¯.updateNeeded=!0}ªt(d,h,b,f,a){¬e=¶Šd.bgCol?a:g.toColor(d.bgCol);£(eŒa ÑtxtŠd.type ÑbtnŠd.type ÑimgŠd.type ÑcustomŠd.type){¬l=d.c;¾d.c;¬k=ÑH+E.CRC32(E.toJS(d));lž(d.c=l);¾h[k] ((f[k]=[d.x,d.y,d.x+d.w-1,d.y+d.h-1]).bg=¶Ša?g.theme.bg:a,bž(b.push(d),b=¶))}£(d.c)§(¬cÆd.c)t(c,h,b,f,e)}p.prototype.setUI=ª(){Bangle.setUI();­d;¯.buttonsž(Bangle.setUI({mode:Ñupdown,back:¯.options.back,remove:¯.options.remove},h¢{¬b=¯.selectedButton,f=¯.buttons.length;£(À0‹hž¯.buttons[b])«¯.buttons[b].cb();¯.buttons[b]ž(¾¯.buttons[b].selected,¯.render(¯.buttons[b]));b=(b+f+h)%f;¯.buttons[b]ž(¯.buttons[b].selected=1,¯.render(¯.buttons[b]));¯.selectedButton=b}),d=!0);!¯.options.backž!¯.options.remove d Bangle.setUI({mode:Ñcustom,back:¯.options.back,remove:¯.options.remove});£(¯.b){ªh(b,f){.75<f.time-f.lastTimež¯.b[b].cbl?¯.b[b].cbl(f):¯.b[b].cbž¯.b[b].cb(f)}Bangle.btnWatchesžBangle.btnWatches.forEach(clearWatch);Bangle.btnWatches=[];¯.b[0]žBangle.btnWatches.push(setWatch(h.bind(¯,0),BTN1,{repeat:!0,edge:-1}));¯.b[1]žBangle.btnWatches.push(setWatch(h.bind(¯,1),BTN2,{repeat:!0,edge:-1}));¯.b[2]žBangle.btnWatches.push(setWatch(h.bind(¯,2),BTN3,{repeat:!0,edge:-1}))}£(2Šprocess.env.HWVERSION){ªh(b,f){b.cbžf.x‘b.xžf.y‘b.yžf.xŽb.x+b.wžf.yŽb.y+b.hž(2Šf.typežb.cbl?b.cbl(f):b.cbžb.cb(f));b.cžb.c.forEach(a¢h(a,f))}Bangle.touchHandler=(b,f)¢h(¯._l,f);Bangle.on(Ñtouch,Bangle.touchHandler)}};p.prototype.render=ª(d){ªh(c){Ñram;b.reset();À0c.colžb.setColor(c.col);À0c.bgColžb.setBgColor(c.bgCol).clearRect(c.x,c.y,c.x+c.w-1,c.y+c.h-1);f[c.type](c)}d (d=¯._l);¯.updateNeededž¯.update();¬b=g,f={"":ª(){},txt:ª(c){Ñram;£(c.wrap){¬m=b.setFont(c.font).setFontAlign(0,-1).wrapString(c.label,c.w),n=c.y+(c.h-b.getFontHeight()*m.length’1);b.drawString(m.join(Ñ
),c.x+(c.w’1),n)}¤b.setFont(c.font).setFontAlign(0,0,c.r).drawString(c.label,c.x+(c.w’1),c.y+(c.h’1))},btn:ª(c){Ñram;¬m=c.x+(0|c.pad),n=c.y+(0|c.pad),q=c.w-(c.pad1),r=c.h-(c.pad1);m=[m,n+4,m+4,n,m+q-5,n,m+q-1,n+4,m+q-1,n+r-5,m+q-5,n+r-1,m+4,n+r-1,m,n+r-5,m,n+4];n=À0c.btnBorderCol?c.btnBorderCol:b.theme.fg2;q=À0c.btnFaceCol?c.btnFaceCol:b.theme.bg2;c.selectedž(q=b.theme.bgH,n=b.theme.fgH);b.setColor(q).fillPoly(m).setColor(n).drawPoly(m);À0c.colžb.setColor(c.col);c.src?b.setBgColor(q).drawImage(ÑfunctionŠ¿c.src?c.src():c.src,c.x+c.w/2,c.y+c.h/2,{scale:c.scale À0,rotate:.5*Math.PI*(c.r 0)}):b.setFont(c.font Ñ6x8:2).setFontAlign(0,0,c.r).drawString(c.label,c.x+c.w/2,c.y+c.h/2)},img:ª(c){Ñram;b.drawImage(ÑfunctionŠ¿c.src?c.src():c.src,c.x+c.w/2,c.y+c.h/2,{scale:c.scale À0,rotate:.5*Math.PI*(c.r 0)})},custom:ª(c){Ñram;c.render(c)},h:ª(c){Ñram;c.c.forEach(h)},v:ª(c){Ñram;c.c.forEach(h)}};£(¯.lazy){¯.rects (¯.rects={});¬a=¯.rects.clone(),e=[];t(d,a,e,¯.rects,¶);§(¬l¹a)¾¯.rects[l];d=Object.keys(a).map(c¢a[c]).reverse();§(¬kÆd)b.setBgColor(k.bg).clearRect.apply(g,k);e.forEach(h)}¤h(d)};p.prototype.forgetLazyState=ª(){¯.rects={}};p.prototype.layout=ª(d){¬h={h:ª(b){Ñram;¬f=b.x+(0|b.pad),a=0,e=b.cžb.c.reduce((k,c)¢k+(0|c.fillx),0);e (f–b.w-b._w’1,e=1);¬l=f;b.c.forEach(k¢{k.x=0|l;f–k._w;a–0|k.fillx;l=f+Math.floor(a*(b.w-b._w)/e);k.w=0|l-k.x;k.h=0|(k.filly?b.h-(b.pad1):k._h);k.y=0|b.y+(0|b.pad)+((1+(0|k.valign))*(b.h-(b.pad1)-k.h)’1);£(k.c)h[k.type](k)})},v:ª(b){Ñram;¬f=b.y+(0|b.pad),a=0,e=b.cžb.c.reduce((k,c)¢k+(0|c.filly),0);e (f–b.h-b._h’1,e=1);¬l=f;b.c.forEach(k¢{k.y=0|l;f–k._h;a–0|k.filly;l=f+Math.floor(a*(b.h-b._h)/e);k.h=0|l-k.y;k.w=0|(k.fillx?b.w-(b.pad1):k._w);k.x=0|b.x+(0|b.pad)+((1+(0|k.halign))*(b.w-(b.pad1)-k.w)’1);£(k.c)h[k.type](k)})}};£(h[d.type])h[d.type](d)};p.prototype.debug=
ª(d,h){d (d=¯._l);h=h 1;g.setColor(h&1,h&2,h&4).drawRect(d.x+h-1,d.y+h-1,d.x+d.w-h,d.y+d.h-h);d.padžg.drawRect(d.x+d.pad-1,d.y+d.pad-1,d.x+d.w-d.pad,d.y+d.h-d.pad);h˜;d.cžd.c.forEach(b¢¯.debug(b,h))};p.prototype.update=ª(){ªd(a){Ñram;b[a.type](a);£(a.r&1){¬e=a._w;a._w=a._h;a._h=e}a._w=Math.max(a._w+(a.pad1),0|a.width);a._h=Math.max(a._h+(a.pad1),0|a.height)}¾¯.updateNeeded;¬h=g,b={txt:ª(a){Ñram;a.font.endsWith(Ñ%)ž(a.font=ÑVector+Math.round(h.getHeight()*a.font.slice(0,-1)/100));£(a.wrap)a._h=a._w=0;¤{¬e=g.setFont(a.font).stringMetrics(a.label);a._w=e.width;a._h=e.height}},btn:ª(a){Ñram;a.fontža.font.endsWith(Ñ%)ž(a.font=ÑVector+Math.round(h.getHeight()*a.font.slice(0,-1)/100));¬e=a.src?h.imageMetrics(ÑfunctionŠ¿a.src?a.src():a.src):h.setFont(a.font Ñ6x8:2).stringMetrics(a.label);a._h=16+e.height;a._w=20+e.width},img:ª(a){Ñram;¬e=h.imageMetrics(ÑfunctionŠ¿a.src?a.src():a.src),l=a.scale 1;a._w=e.width*l;a._h=e.height*l},"":ª(a){Ñram;a._w=0;a._h=0},custom:ª(a){Ñram;a._w=0;a._h=0},h:ª(a){Ñram;a.c.forEach(d);a._h=a.c.reduce((e,l)¢Math.max(e,l._h),0);a._w=a.c.reduce((e,l)¢e+l._w,0);¶Ša.fillxža.c.some(e¢e.fillx)ž(a.fillx=1);¶Ša.fillyža.c.some(e¢e.filly)ž(a.filly=1)},v:ª(a){Ñram;a.c.forEach(d);a._h=a.c.reduce((e,l)¢e+l._h,0);a._w=a.c.reduce((e,l)¢Math.max(e,l._w),0);¶Ša.fillxža.c.some(e¢e.fillx)ž(a.fillx=1);¶Ša.fillyža.c.some(e¢e.filly)ž(a.filly=1)}},f=¯._l;d(f);¾b;f.fillx f.filly?(f.w=Bangle.appRect.w,f.h=Bangle.appRect.h,f.x=Bangle.appRect.x,f.y=Bangle.appRect.y):(f.w=f._w,f.h=f._h,f.x=Bangle.appRect.w-f.w’1,f.y=Bangle.appRect.y+(Bangle.appRect.h-f.h’1));¯.layout(f)};p.prototype.clear=ª(d){d (d=¯._l);g.reset();À0d.bgColžg.setBgColor(d.bgCol);g.clearRect(d.x,d.y,d.x+d.w-1,d.y+d.h-1)};exports=p